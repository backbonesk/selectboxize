/*! selectboxize - v0.7.1 - 2013-09-29
* http://github.com/backbonesk/selectboxize
* Copyright (c) 2013 ; Licensed MIT */
(function(e){e.fn.selectboxize=function(t){t=e.extend({},e.fn.selectboxize.options,t);var n=null,r=function(t){return n=t,e(document).on("click.selectboxize",s).on("keydown.selectboxize",o),n.addClass("opened"),u(n.find('[data-item="'+n.parent().data("selection")+'"]')),n},i=function(t){return n=null,t.removeClass("opened").parent().css("z-index",1),e(document).off("click.selectboxize").off("keydown.selectboxize"),t},s=function(r){var s=e("."+t.theme+"-list:visible").parent().find("*").andSelf();return e.inArray(r.target,s)<0&&n.length&&i(n),!1},o=function(e){var r=n.find("."+t.theme+"-item-hover");switch(e.keyCode){case 9:case 27:i(n);break;case 13:case 32:r.length===1&&(e.preventDefault(),r.trigger("click"));break;case 38:event.preventDefault(),r.length===1?u(r.prev()):u(n.find("."+t.theme+"-item").last());break;case 40:event.preventDefault(),r.length===1?u(r.next()):u(n.find("."+t.theme+"-item").first())}},u=function(e,r){if(e.length!==1)return!1;var i=t.theme+"-item-hover";e.addClass(i).siblings().removeClass(i),r!==!1&&n.scrollTop(e.offset().top-n.offset().top+n.scrollTop())};return this.each(function(){var n=e(this);if(n.filter(":visible").length===0&&!t.replaceInvisible)return;var s=e('<div class="'+t.theme+" "+t.commonClass+'">'+'<a href="#" class="'+t.theme+'-more" />'+'<div class="'+t.theme+'-list" />'+'<span class="'+t.theme+'-current" />'+"</div>");e("option",n).each(function(n,r){var o=e(r),a=e('<span class="'+t.theme+'-item" data-item="'+n+'" data-value="'+o.val()+'">'+o.text()+"</span>");a.on("click",function(n){var r=e(this),s=r.parents("."+t.theme),o=r.data("item"),u=r.data("value");return s.data("selection",o).find("."+t.theme+"-current").text(r.text()),e(s.find("option")).removeAttr("selected"),e(s.find("option")[o]).attr("selected","selected"),e.isFunction(t.callback)&&t.callback.call(this,this,n),i(s.find("."+t.theme+"-list")),!1}).on("mouseover",function(){u(e(this),!1)}),e("."+t.theme+"-list",s).append(a),o.filter(":selected").length>0&&(s.data("selection",n),e("."+t.theme+"-current",s).text(o.text()))}),s.addClass(n.attr("class")),s.insertBefore(n);var o=n.hide().clone(!0);o.appendTo(s),n.remove(),n=o,s.on("click",function(n){e(this).css("z-index",1e3);var s=e(this).find("."+t.theme+"-more"),o=s.siblings("."+t.theme+"-list");return i(e("."+t.theme+"-list").not(o)),r(o),!1});var a=s.find("."+t.theme+"-list"),f=a.find("."+t.theme+"-item").length;f>t.listboxMaxSize&&(f=t.listboxMaxSize),f===0&&(f=1),s.css("width",n.width()),a.css({width:n.width(),height:Math.min(t.listboxMaxSize,f)*24})})},e.fn.selectboxize.options={theme:"selectboxize",commonClass:"selectboxize-replaced",listboxMaxSize:15,replaceInvisible:!1,callback:null}})(jQuery);